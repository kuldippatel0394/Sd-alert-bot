import os, time, requests, yfinance as yf, json
from datetime import datetime, timezone

TOKEN       = os.environ.get("TELEGRAM_BOT_TOKEN", "")
CHAT        = os.environ.get("TELEGRAM_CHAT_ID", "")
GIST_TOKEN  = os.environ.get("GIST_TOKEN", "")
GIST_ID     = os.environ.get("GIST_ID", "")
GIST_FILE   = "sd_bot_state.json"

PAIRS = {
    "EURJPY": "EURJPY=X",
    "EURUSD": "EURUSD=X",
    "GBPUSD": "GBPUSD=X",
    "USDJPY": "USDJPY=X"
}
JPY_PAIRS  = ["EURJPY", "USDJPY"]
ACCOUNT    = 1000.0
RISK_PCT   = 1.0
COOLDOWN_H = 8

def pip_size(pair):
    return 0.05 if pair in JPY_PAIRS else 0.0005

def pip_val(pair):
    return 1000.0 if pair in JPY_PAIRS else 10000.0

def is_market_open():
    now = datetime.now(timezone.utc)
    wd, h = now.weekday(), now.hour
    if wd == 4 and h >= 22: return False
    if wd == 5:              return False
    if wd == 6 and h < 22:  return False
    return True

def session_active(pair):
    h = datetime.now(timezone.utc).hour
    return True if pair in JPY_PAIRS else 7 <= h < 21

def send(text):
    try:
        requests.post(
            "https://api.telegram.org/bot" + TOKEN + "/sendMessage",
            data={"chat_id": CHAT, "text": text},
            timeout=10)
    except Exception as e:
        print("Telegram error: " + str(e))

def load_state():
    if not GIST_TOKEN or not GIST_ID:
        print("No Gist config - using empty state")
        return {}
    try:
        r = requests.get(
            "https://api.github.com/gists/" + GIST_ID,
            headers={"Authorization": "token " + GIST_TOKEN},
            timeout=10)
        content = r.json()["files"][GIST_FILE]["content"]
        state = json.loads(content)
        print("State loaded from Gist: " + str(len(state)) + " keys")
        return state
    except Exception as e:
        print("Gist load error: " + str(e))
        return {}

def save_state(state):
    if not GIST_TOKEN or not GIST_ID:
        return
    try:
        requests.patch(
            "https://api.github.com/gists/" + GIST_ID,
            headers={"Authorization": "token " + GIST_TOKEN},
            json={"files": {GIST_FILE: {"content": json.dumps(state)}}},
            timeout=10)
        print("State saved to Gist: " + str(len(state)) + " keys")
    except Exception as e:
        print("Gist save error: " + str(e))

def get_candles(ticker, interval, period):
    try:
        df = yf.download(ticker, interval=interval, period=period, progress=False)
        df.columns = [c[0] if isinstance(c, tuple) else c for c in df.columns]
        return df[["Open","High","Low","Close"]].dropna()
    except:
        import pandas as pd
        return pd.DataFrame()

def get_d1_trend(ticker):
    df = get_candles(ticker, "1d", "3mo")
    if df.empty or len(df) < 10:
        return "UNKNOWN"
    h = df["High"].values
    l = df["Low"].values
    bullish = h[-1] > h[-4] > h[-8] and l[-1] > l[-4] > l[-8]
    bearish = h[-1] < h[-4] < h[-8] and l[-1] < l[-4] < l[-8]
    if bullish: return "BULLISH"
    if bearish: return "BEARISH"
    return "RANGING"

def get_zones(ticker, price):
    df = get_candles(ticker, "1d", "6mo")
    if df.empty or len(df) < 15:
        return [], []
    H = df["High"].values
    L = df["Low"].values
    O = df["Open"].values
    C = df["Close"].values
    resistance, support = [], []
    for i in range(5, len(df) - 5):
        if H[i] == max(H[i-5:i+6]):
            top = float(H[i])
            bot = float(max(O[i], C[i]))
            mid = (top + bot) / 2
            if price * 0.97 <= mid <= price * 1.03:
                resistance.append({"top": top, "bot": bot, "mid": mid})
        if L[i] == min(L[i-5:i+6]):
            bot = float(L[i])
            top = float(min(O[i], C[i]))
            mid = (top + bot) / 2
            if price * 0.97 <= mid <= price * 1.03:
                support.append({"top": top, "bot": bot, "mid": mid})
    def dedup(zones):
        out = []
        for z in zones:
            if not any(abs(z["mid"]-x["mid"]) < price*0.005 for x in out):
                out.append(z)
        return out
    res = sorted(dedup(resistance), key=lambda x: abs(x["mid"]-price))[:2]
    sup = sorted(dedup(support),    key=lambda x: abs(x["mid"]-price))[:2]
    return res, sup

def rejection_sell(df5, zone):
    if df5 is None or len(df5) < 3:
        return False
    for i in [-3, -2, -1]:
        o  = float(df5["Open"].iloc[i])
        h  = float(df5["High"].iloc[i])
        c  = float(df5["Close"].iloc[i])
        wick_up   = h - max(o, c)
        body_size = abs(c - o)
        if h >= zone["bot"] and c < o and wick_up > body_size * 0.5:
            return True
    return False

def rejection_buy(df5, zone):
    if df5 is None or len(df5) < 3:
        return False
    for i in [-3, -2, -1]:
        o  = float(df5["Open"].iloc[i])
        l  = float(df5["Low"].iloc[i])
        c  = float(df5["Close"].iloc[i])
        wick_dn   = min(o, c) - l
        body_size = abs(c - o)
        if l <= zone["top"] and c > o and wick_dn > body_size * 0.5:
            return True
    return False

def calc_lot(entry, sl, pair):
    diff = abs(entry - sl)
    if diff == 0: return 0.01
    return max(0.01, round((ACCOUNT * RISK_PCT / 100) / (diff * pip_val(pair)), 2))

def akey(pair, ztype, mid, atype):
    return pair + "_" + ztype + "_" + str(round(mid, 2)) + "_" + atype

def cooled(state, key):
    return (time.time() - state.get(key, 0)) > (COOLDOWN_H * 3600)

def scan_pair(pair, ticker, state):
    df5 = get_candles(ticker, "5m", "1d")
    if df5.empty:
        print(pair + ": no data")
        return
    price = float(df5["Close"].iloc[-1])
    trend = get_d1_trend(ticker)
    p     = pip_size(pair)
    sess  = session_active(pair)
    res_zones, sup_zones = get_zones(ticker, price)

    print(pair + " | price=" + str(round(price,5)) +
          " | D1=" + trend +
          " | R=" + str(len(res_zones)) +
          " | S=" + str(len(sup_zones)))

    if trend == "RANGING" or trend == "UNKNOWN":
        print(pair + ": D1 " + trend + " - no alerts")
        return

    for ztype, zones_list in [("RES", res_zones), ("SUP", sup_zones)]:
        for z in zones_list:
            at_zone    = abs(price - z["mid"]) <= p * 6
            above_zone = price > z["top"] * 1.001
            below_zone = price < z["bot"]  * 0.999
            brk_key    = akey(pair, ztype, z["mid"], "break")
            was_broken = brk_key in state

            if ztype == "RES":

                if above_zone and not was_broken:
                    k = akey(pair, ztype, z["mid"], "break")
                    if cooled(state, k):
                        state[brk_key] = time.time()
                        state[k]       = time.time()
                        nxt = sorted([x for x in res_zones if x["mid"] > price], key=lambda x: x["mid"])
                        tp  = str(round(nxt[0]["mid"],5)) if nxt else "watch next zone"
                        send(
                            "BREAKOUT - " + pair + "\n"
                            "Resistance broken!\n\n"
                            "Zone: " + str(round(z["bot"],5)) + " to " + str(round(z["top"],5)) + "\n"
                            "Price: " + str(round(price,5)) + "\n"
                            "D1: " + trend + "\n\n"
                            "WAIT for RETEST of " + str(round(z["mid"],5)) + "\n"
                            "Then look to BUY\n"
                            "Target: " + tp + "\n\n"
                            "Watch M5 for rejection candle\n"
                            "Enter on M1!")

                elif was_broken and at_zone and trend == "BULLISH":
                    k = akey(pair, ztype, z["mid"], "retest")
                    if cooled(state, k) and rejection_buy(df5, z):
                        sl  = z["bot"] - p * 2
                        nxt = sorted([x for x in res_zones if x["mid"] > price], key=lambda x: x["mid"])
                        tp  = round(nxt[0]["mid"],5) if nxt else round(price + p*15, 5)
                        lot = calc_lot(price, sl, pair)
                        state[k] = time.time()
                        send(
                            "RETEST BUY - " + pair + "\n"
                            "Old Resistance now Support!\n"
                            "Nathan BUYS these retests!\n\n"
                            "Zone: " + str(round(z["bot"],5)) + " to " + str(round(z["top"],5)) + "\n"
                            "Price: " + str(round(price,5)) + "\n"
                            "D1: BULLISH\n"
                            "M5 Rejection candle: CONFIRMED\n"
                            "Session: " + ("ACTIVE" if sess else "OFF HOURS") + "\n\n"
                            "SL: " + str(round(sl,5)) + "\n"
                            "TP: " + str(tp) + "\n"
                            "Lot: " + str(lot) + "\n\n"
                            "Enter on M1!")

                elif not was_broken and at_zone and trend == "BEARISH":
                    k = akey(pair, ztype, z["mid"], "touch")
                    if cooled(state, k) and rejection_sell(df5, z):
                        sl  = z["top"] + p * 2
                        nxt = sorted([x for x in sup_zones if x["mid"] < price], key=lambda x: x["mid"], reverse=True)
                        tp  = round(nxt[0]["mid"],5) if nxt else round(price - p*15, 5)
                        lot = calc_lot(price, sl, pair)
                        state[k] = time.time()
                        send(
                            "SELL SETUP - " + pair + "\n"
                            "Price at Resistance!\n"
                            "Nathan SELLS here!\n\n"
                            "Zone: " + str(round(z["bot"],5)) + " to " + str(round(z["top"],5)) + "\n"
                            "Price: " + str(round(price,5)) + "\n"
                            "D1: BEARISH\n"
                            "M5 Rejection candle: CONFIRMED\n"
                            "Session: " + ("ACTIVE" if sess else "OFF HOURS") + "\n\n"
                            "SL: " + str(round(sl,5)) + "\n"
                            "TP: " + str(tp) + "\n"
                            "Lot: " + str(lot) + "\n\n"
                            "Enter on M1!")

            elif ztype == "SUP":

                if below_zone and not was_broken:
                    k = akey(pair, ztype, z["mid"], "break")
                    if cooled(state, k):
                        state[brk_key] = time.time()
                        state[k]       = time.time()
                        nxt = sorted([x for x in sup_zones if x["mid"] < price], key=lambda x: x["mid"], reverse=True)
                        tp  = str(round(nxt[0]["mid"],5)) if nxt else "watch next zone"
                        send(
                            "BREAKOUT - " + pair + "\n"
                            "Support broken!\n\n"
                            "Zone: " + str(round(z["bot"],5)) + " to " + str(round(z["top"],5)) + "\n"
                            "Price: " + str(round(price,5)) + "\n"
                            "D1: " + trend + "\n\n"
                            "WAIT for RETEST of " + str(round(z["mid"],5)) + "\n"
                            "Then look to SELL\n"
                            "Target: " + tp + "\n\n"
                            "Watch M5 for rejection candle\n"
                            "Enter on M1!")

                elif was_broken and at_zone and trend == "BEARISH":
                    k = akey(pair, ztype, z["mid"], "retest")
                    if cooled(state, k) and rejection_sell(df5, z):
                        sl  = z["top"] + p * 2
                        nxt = sorted([x for x in sup_zones if x["mid"] < price], key=lambda x: x["mid"], reverse=True)
                        tp  = round(nxt[0]["mid"],5) if nxt else round(price - p*15, 5)
                        lot = calc_lot(price, sl, pair)
                        state[k] = time.time()
                        send(
                            "RETEST SELL - " + pair + "\n"
                            "Old Support now Resistance!\n"
                            "Nathan SELLS these retests!\n\n"
                            "Zone: " + str(round(z["bot"],5)) + " to " + str(round(z["top"],5)) + "\n"
                            "Price: " + str(round(price,5)) + "\n"
                            "D1: BEARISH\n"
                            "M5 Rejection candle: CONFIRMED\n"
                            "Session: " + ("ACTIVE" if sess else "OFF HOURS") + "\n\n"
                            "SL: " + str(round(sl,5)) + "\n"
                            "TP: " + str(tp) + "\n"
                            "Lot: " + str(lot) + "\n\n"
                            "Enter on M1!")

                elif not was_broken and at_zone and trend == "BULLISH":
                    k = akey(pair, ztype, z["mid"], "touch")
                    if cooled(state, k) and rejection_buy(df5, z):
                        sl  = z["bot"] - p * 2
                        nxt = sorted([x for x in res_zones if x["mid"] > price], key=lambda x: x["mid"])
                        tp  = round(nxt[0]["mid"],5) if nxt else round(price + p*15, 5)
                        lot = calc_lot(price, sl, pair)
                        state[k] = time.time()
                        send(
                            "BUY SETUP - " + pair + "\n"
                            "Price at Support!\n"
                            "Nathan BUYS here!\n\n"
                            "Zone: " + str(round(z["bot"],5)) + " to " + str(round(z["top"],5)) + "\n"
                            "Price: " + str(round(price,5)) + "\n"
                            "D1: BULLISH\n"
                            "M5 Rejection candle: CONFIRMED\n"
                            "Session: " + ("ACTIVE" if sess else "OFF HOURS") + "\n\n"
                            "SL: " + str(round(sl,5)) + "\n"
                            "TP: " + str(tp) + "\n"
                            "Lot: " + str(lot) + "\n\n"
                            "Enter on M1!")

def main():
    print("Nathan SD Bot - " + str(datetime.now(timezone.utc)))
    if not TOKEN or not CHAT:
        print("ERROR: missing TELEGRAM env vars")
        return
    if not is_market_open():
        print("Weekend - market closed - bot silent")
        return
    state = load_state()
    for pair, ticker in PAIRS.items():
        try:
            scan_pair(pair, ticker, state)
        except Exception as e:
            print("Error " + pair + ": " + str(e))
    save_state(state)
    print("Done")

if __name__ == "__main__":
    main()
