import os, time, requests, yfinance as yf, numpy as np
from datetime import datetime, timezone

TOKEN = os.environ.get("TELEGRAM_BOT_TOKEN", "")
CHAT = os.environ.get("TELEGRAM_CHAT_ID", "")
PAIRS = {"EURJPY": "EURJPY=X", "EURUSD": "EURUSD=X", "GBPUSD": "GBPUSD=X", "USDJPY": "USDJPY=X"}
JPY = ["EURJPY", "USDJPY"]
ACCOUNT = 1000.0
RISK = 1.0
COOLDOWN = 21600

def pip(pair):
    return 0.05 if pair in JPY else 0.0005

def send(text):
    try:
        requests.post("https://api.telegram.org/bot" + TOKEN + "/sendMessage",
            data={"chat_id": CHAT, "text": text}, timeout=10)
    except:
        pass

def candles(ticker, interval, period):
    try:
        df = yf.download(ticker, interval=interval, period=period, progress=False)
        df.columns = [c[0] if isinstance(c, tuple) else c for c in df.columns]
        return df[["Open", "High", "Low", "Close"]].dropna()
    except:
        import pandas as pd
        return pd.DataFrame()

def get_trend(ticker):
    df = candles(ticker, "1d", "3mo")
    if df.empty or len(df) < 10:
        return "UNKNOWN", "UNKNOWN"
    h = df["High"].values
    l = df["Low"].values
    if h[-1] > h[-5] > h[-10] and l[-1] > l[-5] > l[-10]:
        d1 = "BULLISH"
    elif h[-1] < h[-5] < h[-10] and l[-1] < l[-5] < l[-10]:
        d1 = "BEARISH"
    else:
        d1 = "RANGING"
    df4 = candles(ticker, "4h", "30d")
    if df4.empty or len(df4) < 10:
        return d1, "UNKNOWN"
    h4 = df4["High"].values
    l4 = df4["Low"].values
    if h4[-1] > h4[-5] > h4[-10] and l4[-1] > l4[-5] > l4[-10]:
        h4t = "BULLISH"
    elif h4[-1] < h4[-5] < h4[-10] and l4[-1] < l4[-5] < l4[-10]:
        h4t = "BEARISH"
    else:
        h4t = "RANGING"
    return d1, h4t

def find_zones(ticker, price):
    df = candles(ticker, "1d", "1y")
    if df.empty or len(df) < 20:
        return [], []
    highs = df["High"].values
    lows = df["Low"].values
    opens = df["Open"].values
    closes = df["Close"].values
    resistance_zones = []
    support_zones = []
    for i in range(5, len(df) - 5):
        left_high = max(highs[i-5:i])
        right_high = max(highs[i+1:i+6])
        if highs[i] > left_high and highs[i] > right_high:
            move_away = abs(closes[i+1] - highs[i])
            if move_away > price * 0.002:
                zone_top = float(highs[i])
                zone_bottom = float(max(opens[i], closes[i]))
                mid = (zone_top + zone_bottom) / 2
                if price * 0.97 <= mid <= price * 1.03:
                    resistance_zones.append({
                        "top": zone_top, "bottom": zone_bottom, "mid": mid,
                        "tf": "D1", "type": "RESISTANCE"
                    })
        left_low = min(lows[i-5:i])
        right_low = min(lows[i+1:i+6])
        if lows[i] < left_low and lows[i] < right_low:
            move_away = abs(closes[i+1] - lows[i])
            if move_away > price * 0.002:
                zone_bottom = float(lows[i])
                zone_top = float(min(opens[i], closes[i]))
                mid = (zone_top + zone_bottom) / 2
                if price * 0.97 <= mid <= price * 1.03:
                    support_zones.append({
                        "top": zone_top, "bottom": zone_bottom, "mid": mid,
                        "tf": "D1", "type": "SUPPORT"
                    })
    res = sorted(resistance_zones, key=lambda x: abs(x["mid"] - price))[:2]
    sup = sorted(support_zones, key=lambda x: abs(x["mid"] - price))[:2]
    return res, sup

def session_ok(pair):
    h = datetime.now(timezone.utc).hour
    if pair in JPY:
        return True
    return 7 <= h < 21

def lot_size(entry, sl, pair):
    diff = abs(entry - sl)
    if diff == 0:
        return 0.01
    pv = 1000 if pair in JPY else 10000
    return max(0.01, round((ACCOUNT * RISK / 100) / (diff * pv), 2))

def load():
    import json
    try:
        if os.path.exists("state.txt"):
            return json.load(open("state.txt"))
    except:
        pass
    return {"breaks": [], "alerts": {}}

def save(state):
    import json
    try:
        json.dump(state, open("state.txt", "w"))
    except:
        pass

def scan(pair, ticker, state):
    df5 = candles(ticker, "5m", "1d")
    if df5.empty:
        return
    price = float(df5["Close"].iloc[-1])
    now = time.time()
    d1t, h4t = get_trend(ticker)
    trend = d1t if d1t != "RANGING" else h4t
    sess = session_ok(pair)
    res_zones, sup_zones = find_zones(ticker, price)
    all_zones = res_zones + sup_zones
    breaks = state.get("breaks", [])
    alerts = state.get("alerts", {})
    p = pip(pair)

    print(pair + " price=" + str(round(price, 5)) +
          " D1=" + d1t + " H4=" + h4t +
          " R-zones=" + str(len(res_zones)) +
          " S-zones=" + str(len(sup_zones)))

    for z in all_zones:
        zid = pair + z["tf"] + z["type"] + str(round(z["mid"], 2))
        label = z["tf"] + " " + z["type"]
        broken = zid in breaks
        at_zone = z["bottom"] <= price <= z["top"] or abs(price - z["mid"]) <= p * 4
        above = price > z["top"] * 1.002
        below = price < z["bottom"] * 0.998

        if not broken:
            if z["type"] == "RESISTANCE" and above:
                bid = zid + "_brk"
                if now - alerts.get(bid, 0) < COOLDOWN:
                    continue
                breaks.append(zid)
                alerts[bid] = now
                state["breaks"] = breaks
                state["alerts"] = alerts
                nxt = sorted([s for s in sup_zones + res_zones if s["mid"] > price],
                    key=lambda x: x["mid"])
                tp = "Next zone: " + str(round(nxt[0]["mid"], 5)) if nxt else "Watch price action"
                send("BREAKOUT - " + pair + "\n"
                     "BULLISH - Resistance Broken!\n\n"
                     "Zone: " + label + "\n"
                     "Level: " + str(round(z["bottom"], 5)) + " to " + str(round(z["top"], 5)) + "\n"
                     "Price now: " + str(round(price, 5)) + "\n"
                     "D1: " + d1t + " | H4: " + h4t + "\n\n"
                     "WAIT for price to come BACK\n"
                     "and RETEST " + str(round(z["mid"], 5)) + "\n"
                     "Then look to BUY\n"
                     "Target: " + tp + "\n\n"
                     "Watch M5 for reversal candle\n"
                     "Enter on M1!")

            elif z["type"] == "SUPPORT" and below:
                bid = zid + "_brk"
                if now - alerts.get(bid, 0) < COOLDOWN:
                    continue
                breaks.append(zid)
                alerts[bid] = now
                state["breaks"] = breaks
                state["alerts"] = alerts
                nxt = sorted([s for s in sup_zones + res_zones if s["mid"] < price],
                    key=lambda x: x["mid"], reverse=True)
                tp = "Next zone: " + str(round(nxt[0]["mid"], 5)) if nxt else "Watch price action"
                send("BREAKOUT - " + pair + "\n"
                     "BEARISH - Support Broken!\n\n"
                     "Zone: " + label + "\n"
                     "Level: " + str(round(z["bottom"], 5)) + " to " + str(round(z["top"], 5)) + "\n"
                     "Price now: " + str(round(price, 5)) + "\n"
                     "D1: " + d1t + " | H4: " + h4t + "\n\n"
                     "WAIT for price to come BACK\n"
                     "and RETEST " + str(round(z["mid"], 5)) + "\n"
                     "Then look to SELL\n"
                     "Target: " + tp + "\n\n"
                     "Watch M5 for reversal candle\n"
                     "Enter on M1!")

            elif at_zone:
                aid = zid + "_touch"
                if now - alerts.get(aid, 0) < COOLDOWN:
                    continue
                if z["type"] == "RESISTANCE" and trend in ["BEARISH", "RANGING"]:
                    sl = z["top"] + p * 3
                    nxt = sorted([s for s in sup_zones if s["mid"] < price],
                        key=lambda x: x["mid"], reverse=True)
                    tp = round(nxt[0]["mid"], 5) if nxt else round(price - p * 12, 5)
                    l = lot_size(price, sl, pair)
                    alerts[aid] = now
                    state["alerts"] = alerts
                    send("ZONE ALERT - " + pair + "\n"
                         "SELL - Unbroken Resistance Zone\n"
                         "Nathan SELLS here!\n\n"
                         "Zone: " + label + "\n"
                         "Zone: " + str(round(z["bottom"], 5)) + " to " + str(round(z["top"], 5)) + "\n"
                         "Price: " + str(round(price, 5)) + "\n"
                         "D1: " + d1t + " | H4: " + h4t + "\n"
                         "Session: " + ("OK" if sess else "WAIT - off hours") + "\n\n"
                         "SL: above " + str(round(sl, 5)) + "\n"
                         "TP: " + str(tp) + " (next support zone)\n"
                         "Lot: " + str(l) + "\n\n"
                         "Look for REJECTION candle on M5\n"
                         "Then enter on M1!")

                elif z["type"] == "SUPPORT" and trend in ["BULLISH", "RANGING"]:
                    sl = z["bottom"] - p * 3
                    nxt = sorted([s for s in res_zones if s["mid"] > price],
                        key=lambda x: x["mid"])
                    tp = round(nxt[0]["mid"], 5) if nxt else round(price + p * 12, 5)
                    l = lot_size(price, sl, pair)
                    alerts[aid] = now
                    state["alerts"] = alerts
                    send("ZONE ALERT - " + pair + "\n"
                         "BUY - Unbroken Support Zone\n"
                         "Nathan BUYS here!\n\n"
                         "Zone: " + label + "\n"
                         "Zone: " + str(round(z["bottom"], 5)) + " to " + str(round(z["top"], 5)) + "\n"
                         "Price: " + str(round(price, 5)) + "\n"
                         "D1: " + d1t + " | H4: " + h4t + "\n"
                         "Session: " + ("OK" if sess else "WAIT - off hours") + "\n\n"
                         "SL: below " + str(round(sl, 5)) + "\n"
                         "TP: " + str(tp) + " (next resistance zone)\n"
                         "Lot: " + str(l) + "\n\n"
                         "Look for REJECTION candle on M5\n"
                         "Then enter on M1!")
        else:
            if not at_zone:
                continue
            aid = zid + "_retest"
            if now - alerts.get(aid, 0) < COOLDOWN:
                continue
            if z["type"] == "RESISTANCE" and trend in ["BULLISH", "RANGING"]:
                sl = z["bottom"] - p * 3
                nxt = sorted([s for s in res_zones if s["mid"] > price],
                    key=lambda x: x["mid"])
                tp = round(nxt[0]["mid"], 5) if nxt else round(price + p * 12, 5)
                l = lot_size(price, sl, pair)
                alerts[aid] = now
                state["alerts"] = alerts
                send("RETEST ALERT - " + pair + "\n"
                     "BUY - Role Reversal!\n"
                     "Old Resistance is now Support\n"
                     "Nathan BUYS these retests!\n\n"
                     "Zone: " + label + "\n"
                     "Zone: " + str(round(z["bottom"], 5)) + " to " + str(round(z["top"], 5)) + "\n"
                     "Price: " + str(round(price, 5)) + "\n"
                     "D1: " + d1t + " | H4: " + h4t + "\n"
                     "Session: " + ("OK" if sess else "WAIT - off hours") + "\n\n"
                     "SL: below " + str(round(sl, 5)) + "\n"
                     "TP: " + str(tp) + " (next zone)\n"
                     "Lot: " + str(l) + "\n\n"
                     "Look for REJECTION candle on M5\n"
                     "Then enter on M1!")

            elif z["type"] == "SUPPORT" and trend in ["BEARISH", "RANGING"]:
                sl = z["top"] + p * 3
                nxt = sorted([s for s in sup_zones if s["mid"] < price],
                    key=lambda x: x["mid"], reverse=True)
                tp = round(nxt[0]["mid"], 5) if nxt else round(price - p * 12, 5)
                l = lot_size(price, sl, pair)
                alerts[aid] = now
                state["alerts"] = alerts
                send("RETEST ALERT - " + pair + "\n"
                     "SELL - Role Reversal!\n"
                     "Old Support is now Resistance\n"
                     "Nathan SELLS these retests!\n\n"
                     "Zone: " + label + "\n"
                     "Zone: " + str(round(z["bottom"], 5)) + " to " + str(round(z["top"], 5)) + "\n"
                     "Price: " + str(round(price, 5)) + "\n"
                     "D1: " + d1t + " | H4: " + h4t + "\n"
                     "Session: " + ("OK" if sess else "WAIT - off hours") + "\n\n"
                     "SL: above " + str(round(sl, 5)) + "\n"
                     "TP: " + str(tp) + " (next zone)\n"
                     "Lot: " + str(l) + "\n\n"
                     "Look for REJECTION candle on M5\n"
                     "Then enter on M1!")

def main():
    print("Nathan SD Bot - " + str(datetime.now(timezone.utc)))
    if not TOKEN or not CHAT:
        print("ERROR: Missing TELEGRAM env vars")
        return
    state = load()
    for pair, ticker in PAIRS.items():
        try:
            scan(pair, ticker, state)
        except Exception as e:
            print("Error " + pair + ": " + str(e))
    save(state)
    print("Done")

if __name__ == "__main__":
    main()
