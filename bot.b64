import os, time, requests, yfinance as yf, numpy as np
from datetime import datetime, timezone

TOKEN = os.environ.get("TELEGRAM_BOT_TOKEN", "")
CHAT = os.environ.get("TELEGRAM_CHAT_ID", "")
PAIRS = {"EURJPY": "EURJPY=X", "EURUSD": "EURUSD=X", "GBPUSD": "GBPUSD=X", "USDJPY": "USDJPY=X"}
JPY = ["EURJPY", "USDJPY"]
ACCOUNT = 1000.0
RISK = 1.0
COOLDOWN = 21600

def pip(pair):
    return 0.05 if pair in JPY else 0.0005

def msg(text):
    try:
        requests.post("https://api.telegram.org/bot" + TOKEN + "/sendMessage",
            data={"chat_id": CHAT, "text": text}, timeout=10)
    except:
        pass

def candles(ticker, interval, period):
    try:
        df = yf.download(ticker, interval=interval, period=period, progress=False)
        df.columns = [c[0] if isinstance(c, tuple) else c for c in df.columns]
        return df[["Open", "High", "Low", "Close"]].dropna()
    except:
        import pandas as pd
        return pd.DataFrame()

def get_trend(ticker):
    d1 = candles(ticker, "1d", "3mo")
    if d1.empty or len(d1) < 10:
        return "UNKNOWN", "UNKNOWN"
    h = d1["High"].values
    l = d1["Low"].values
    hh = h[-1] > h[-5] and h[-5] > h[-10]
    hl = l[-1] > l[-5] and l[-5] > l[-10]
    lh = h[-1] < h[-5] and h[-5] < h[-10]
    ll = l[-1] < l[-5] and l[-5] < l[-10]
    if hh and hl:
        d1_trend = "BULLISH"
    elif lh and ll:
        d1_trend = "BEARISH"
    else:
        d1_trend = "RANGING"
    h4 = candles(ticker, "4h", "30d")
    if h4.empty or len(h4) < 10:
        return d1_trend, "UNKNOWN"
    h4h = h4["High"].values
    h4l = h4["Low"].values
    h4hh = h4h[-1] > h4h[-5] and h4h[-5] > h4h[-10]
    h4hl = h4l[-1] > h4l[-5] and h4l[-5] > h4l[-10]
    h4lh = h4h[-1] < h4h[-5] and h4h[-5] < h4h[-10]
    h4ll = h4l[-1] < h4l[-5] and h4l[-5] < h4l[-10]
    if h4hh and h4hl:
        h4_trend = "BULLISH"
    elif h4lh and h4ll:
        h4_trend = "BEARISH"
    else:
        h4_trend = "RANGING"
    return d1_trend, h4_trend

def get_swing_zones(ticker):
    zones = []
    for interval, label, period in [("1d", "D1", "1y"), ("4h", "H4", "3mo")]:
        df = candles(ticker, interval, period)
        if df.empty or len(df) < 20:
            continue
        highs = df["High"].values
        lows = df["Low"].values
        closes = df["Close"].values
        for i in range(3, len(df) - 3):
            is_swing_high = highs[i] >= max(highs[i-3:i]) and highs[i] >= max(highs[i+1:i+4])
            if is_swing_high:
                zone_top = float(highs[i])
                zone_bottom = float(min(df["Open"].values[i], df["Close"].values[i]))
                touches = sum(1 for j in range(len(df))
                    if abs(highs[j] - zone_top) / zone_top < 0.003 or
                       abs(lows[j] - zone_top) / zone_top < 0.003)
                zones.append({
                    "type": "RESISTANCE",
                    "tf": label,
                    "top": zone_top,
                    "bottom": zone_bottom,
                    "mid": (zone_top + zone_bottom) / 2,
                    "touches": touches
                })
            is_swing_low = lows[i] <= min(lows[i-3:i]) and lows[i] <= min(lows[i+1:i+4])
            if is_swing_low:
                zone_bottom = float(lows[i])
                zone_top = float(max(df["Open"].values[i], df["Close"].values[i]))
                touches = sum(1 for j in range(len(df))
                    if abs(highs[j] - zone_bottom) / zone_bottom < 0.003 or
                       abs(lows[j] - zone_bottom) / zone_bottom < 0.003)
                zones.append({
                    "type": "SUPPORT",
                    "tf": label,
                    "top": zone_top,
                    "bottom": zone_bottom,
                    "mid": (zone_top + zone_bottom) / 2,
                    "touches": touches
                })
    deduped = []
    for z in zones:
        if not any(abs(z["mid"] - d["mid"]) / z["mid"] < 0.002 for d in deduped):
            deduped.append(z)
    deduped.sort(key=lambda x: x["mid"])
    return deduped

def find_next_zone(zones, current_price, direction):
    if direction == "DOWN":
        targets = [z for z in zones if z["mid"] < current_price * 0.998]
        return targets[-1] if targets else None
    else:
        targets = [z for z in zones if z["mid"] > current_price * 1.002]
        return targets[0] if targets else None

def session_ok(pair):
    h = datetime.now(timezone.utc).hour
    if pair in JPY:
        return True
    return 7 <= h < 21

def lot_size(entry, sl, pair):
    diff = abs(entry - sl)
    if diff == 0:
        return 0.01
    pv = 1000 if pair in JPY else 10000
    return max(0.01, round((ACCOUNT * RISK / 100) / (diff * pv), 2))

def load():
    import json
    try:
        if os.path.exists("state.txt"):
            return json.load(open("state.txt"))
    except:
        pass
    return {"breaks": [], "alerts": {}}

def save(state):
    import json
    try:
        json.dump(state, open("state.txt", "w"))
    except:
        pass

def scan(pair, ticker, state):
    df = candles(ticker, "5m", "1d")
    if df.empty:
        return
    price = float(df["Close"].iloc[-1])
    now = time.time()
    d1_trend, h4_trend = get_trend(ticker)
    trend = d1_trend if d1_trend != "RANGING" else h4_trend
    sess = session_ok(pair)
    zones = get_swing_zones(ticker)
    if not zones:
        print(pair + " no zones found")
        return
    breaks = state.get("breaks", [])
    alerts = state.get("alerts", {})
    p = pip(pair)
    print(pair + " price=" + str(round(price, 5)) + " D1=" + d1_trend + " H4=" + h4_trend + " zones=" + str(len(zones)))

    for z in zones:
        zid = pair + z["tf"] + z["type"] + str(round(z["mid"], 3))
        label = z["tf"] + " " + z["type"]
        broken = zid in breaks
        at_zone = abs(price - z["mid"]) <= p * 3
        above_zone = price > z["top"] * 1.001
        below_zone = price < z["bottom"] * 0.999

        if not broken:
            if z["type"] == "RESISTANCE" and above_zone:
                bid = zid + "_brk"
                if now - alerts.get(bid, 0) < COOLDOWN:
                    continue
                breaks.append(zid)
                alerts[bid] = now
                state["breaks"] = breaks
                state["alerts"] = alerts
                next_z = find_next_zone(zones, price, "UP")
                tp_info = "Next zone: " + str(round(next_z["mid"], 5)) if next_z else "Watch next swing high"
                msg("BREAKOUT - " + pair + "\n"
                    "BULLISH - Resistance broken!\n"
                    "Zone: " + label + " at " + str(round(z["mid"], 5)) + "\n"
                    "Price: " + str(round(price, 5)) + "\n"
                    "D1: " + d1_trend + " | H4: " + h4_trend + "\n"
                    "Touches: " + str(z["touches"]) + "\n\n"
                    "WAIT for RETEST of " + str(round(z["mid"], 5)) + "\n"
                    "Then look to BUY\n"
                    "Target: " + tp_info + "\n\n"
                    "Confirm reversal on M5 then enter M1!")

            elif z["type"] == "SUPPORT" and below_zone:
                bid = zid + "_brk"
                if now - alerts.get(bid, 0) < COOLDOWN:
                    continue
                breaks.append(zid)
                alerts[bid] = now
                state["breaks"] = breaks
                state["alerts"] = alerts
                next_z = find_next_zone(zones, price, "DOWN")
                tp_info = "Next zone: " + str(round(next_z["mid"], 5)) if next_z else "Watch next swing low"
                msg("BREAKOUT - " + pair + "\n"
                    "BEARISH - Support broken!\n"
                    "Zone: " + label + " at " + str(round(z["mid"], 5)) + "\n"
                    "Price: " + str(round(price, 5)) + "\n"
                    "D1: " + d1_trend + " | H4: " + h4_trend + "\n"
                    "Touches: " + str(z["touches"]) + "\n\n"
                    "WAIT for RETEST of " + str(round(z["mid"], 5)) + "\n"
                    "Then look to SELL\n"
                    "Target: " + tp_info + "\n\n"
                    "Confirm reversal on M5 then enter M1!")

            elif at_zone:
                aid = zid + "_touch"
                if now - alerts.get(aid, 0) < COOLDOWN:
                    continue
                if z["type"] == "RESISTANCE":
                    if trend == "BEARISH" or trend == "RANGING":
                        sl = z["top"] + p * 2
                        next_z = find_next_zone(zones, price, "DOWN")
                        tp = round(next_z["mid"], 5) if next_z else round(price - p * 10, 5)
                        l = lot_size(price, sl, pair)
                        alerts[aid] = now
                        state["alerts"] = alerts
                        msg("ZONE ALERT - " + pair + "\n"
                            "SELL SETUP - Unbroken Resistance\n"
                            "Nathan SELLS at this zone!\n\n"
                            "Zone: " + label + "\n"
                            "Zone level: " + str(round(z["bottom"], 5)) + " - " + str(round(z["top"], 5)) + "\n"
                            "Price: " + str(round(price, 5)) + "\n"
                            "Touches: " + str(z["touches"]) + "\n\n"
                            "D1: " + d1_trend + " | H4: " + h4_trend + "\n"
                            "Session: " + ("OK" if sess else "WAIT - off hours") + "\n\n"
                            "SL: " + str(round(sl, 5)) + "\n"
                            "TP: " + str(tp) + " (next zone)\n"
                            "Lot: " + str(l) + "\n\n"
                            "Confirm REJECTION candle on M5\n"
                            "Then enter on M1!")
                elif z["type"] == "SUPPORT":
                    if trend == "BULLISH" or trend == "RANGING":
                        sl = z["bottom"] - p * 2
                        next_z = find_next_zone(zones, price, "UP")
                        tp = round(next_z["mid"], 5) if next_z else round(price + p * 10, 5)
                        l = lot_size(price, sl, pair)
                        alerts[aid] = now
                        state["alerts"] = alerts
                        msg("ZONE ALERT - " + pair + "\n"
                            "BUY SETUP - Unbroken Support\n"
                            "Nathan BUYS at this zone!\n\n"
                            "Zone: " + label + "\n"
                            "Zone level: " + str(round(z["bottom"], 5)) + " - " + str(round(z["top"], 5)) + "\n"
                            "Price: " + str(round(price, 5)) + "\n"
                            "Touches: " + str(z["touches"]) + "\n\n"
                            "D1: " + d1_trend + " | H4: " + h4_trend + "\n"
                            "Session: " + ("OK" if sess else "WAIT - off hours") + "\n\n"
                            "SL: " + str(round(sl, 5)) + "\n"
                            "TP: " + str(tp) + " (next zone)\n"
                            "Lot: " + str(l) + "\n\n"
                            "Confirm REJECTION candle on M5\n"
                            "Then enter on M1!")
        else:
            if not at_zone:
                continue
            aid = zid + "_retest"
            if now - alerts.get(aid, 0) < COOLDOWN:
                continue
            if z["type"] == "RESISTANCE" and (trend == "BULLISH" or trend == "RANGING"):
                sl = z["bottom"] - p * 2
                next_z = find_next_zone(zones, price, "UP")
                tp = round(next_z["mid"], 5) if next_z else round(price + p * 10, 5)
                l = lot_size(price, sl, pair)
                alerts[aid] = now
                state["alerts"] = alerts
                msg("RETEST ALERT - " + pair + "\n"
                    "BUY SETUP - Role Reversal!\n"
                    "Old Resistance now Support\n"
                    "Nathan BUYS retests!\n\n"
                    "Zone: " + label + "\n"
                    "Zone level: " + str(round(z["bottom"], 5)) + " - " + str(round(z["top"], 5)) + "\n"
                    "Price: " + str(round(price, 5)) + "\n"
                    "Touches: " + str(z["touches"]) + " (Nathan loves 2-3!)\n\n"
                    "D1: " + d1_trend + " | H4: " + h4_trend + "\n"
                    "Session: " + ("OK" if sess else "WAIT - off hours") + "\n\n"
                    "SL: " + str(round(sl, 5)) + "\n"
                    "TP: " + str(tp) + " (next zone)\n"
                    "Lot: " + str(l) + "\n\n"
                    "Confirm REJECTION candle on M5\n"
                    "Then enter on M1!")
            elif z["type"] == "SUPPORT" and (trend == "BEARISH" or trend == "RANGING"):
                sl = z["top"] + p * 2
                next_z = find_next_zone(zones, price, "DOWN")
                tp = round(next_z["mid"], 5) if next_z else round(price - p * 10, 5)
                l = lot_size(price, sl, pair)
                alerts[aid] = now
                state["alerts"] = alerts
                msg("RETEST ALERT - " + pair + "\n"
                    "SELL SETUP - Role Reversal!\n"
                    "Old Support now Resistance\n"
                    "Nathan SELLS retests!\n\n"
                    "Zone: " + label + "\n"
                    "Zone level: " + str(round(z["bottom"], 5)) + " - " + str(round(z["top"], 5)) + "\n"
                    "Price: " + str(round(price, 5)) + "\n"
                    "Touches: " + str(z["touches"]) + " (Nathan loves 2-3!)\n\n"
                    "D1: " + d1_trend + " | H4: " + h4_trend + "\n"
                    "Session: " + ("OK" if sess else "WAIT - off hours") + "\n\n"
                    "SL: " + str(round(sl, 5)) + "\n"
                    "TP: " + str(tp) + " (next zone)\n"
                    "Lot: " + str(l) + "\n\n"
                    "Confirm REJECTION candle on M5\n"
                    "Then enter on M1!")

def main():
    print("Nathan Williams SD Bot - " + str(datetime.now(timezone.utc)))
    if not TOKEN or not CHAT:
        print("ERROR: Missing env vars")
        return
    state = load()
    for pair, ticker in PAIRS.items():
        try:
            scan(pair, ticker, state)
        except Exception as e:
            print("Error " + pair + ": " + str(e))
    save(state)
    print("Done")

if __name__ == "__main__":
    main()
